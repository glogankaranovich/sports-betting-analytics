#!/bin/bash
# Script to forcefully delete node_modules including hidden files

TARGET_DIR="${1:-../frontend}"

cd "$TARGET_DIR" || exit 1

if [ -d "node_modules" ]; then
    echo "Deleting node_modules in $(pwd)..."
    
    # Count files first
    FILE_COUNT=$(find node_modules -type f 2>/dev/null | wc -l)
    echo "Found $FILE_COUNT files to delete..."
    
    # Find and delete all files (including hidden) in node_modules
    echo "Deleting files..."
    find node_modules -type f -delete -print 2>/dev/null | while read -r file; do
        echo "  Deleted: $file"
    done
    
    # Count directories
    DIR_COUNT=$(find node_modules -type d 2>/dev/null | wc -l)
    echo "Found $DIR_COUNT directories to delete..."
    
    # Find and delete all directories (including hidden) in node_modules, deepest first
    echo "Deleting directories..."
    find node_modules -depth -type d -print -exec rmdir {} \; 2>/dev/null
    
    # If directory still exists, use rm -rf as last resort
    if [ -d "node_modules" ]; then
        echo "Using rm -rf for remaining files..."
        rm -rfv node_modules
    fi
    
    echo "node_modules deleted"
else
    echo "node_modules directory not found"
fi

# Also clean package-lock.json
if [ -f "package-lock.json" ]; then
    rm -fv package-lock.json
    echo "package-lock.json deleted"
fi

echo "Done! Now run: npm install"
